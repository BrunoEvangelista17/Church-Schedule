language: node_js

node_js:
  - "18"
  - "20"

# Desabilita o comando padrão de teste do Travis
install: skip
script: skip

# Cache para acelerar builds
cache:
  directories:
    - Codigo/client/node_modules
    - Codigo/server/node_modules

# Matriz de jobs para testar client e server
jobs:
  include:
    # Job para o servidor - Testes com Jest
    - name: "Server - Tests with Coverage"
      before_script:
        - cd Codigo/server
      script:
        - npm ci
        - npm run test:ci
      after_success:
        - echo "Testes do servidor concluídos com sucesso!"
        - cat coverage/lcov.info 2>/dev/null || echo "Coverage report gerado"

    # Job para o cliente
    - name: "Client - Lint and Build"
      before_script:
        - cd Codigo/client
      script:
        - npm install
        - npm run lint
        - npm run build

    # Job adicional para lint do servidor
    - name: "Server - Lint Check"
      before_script:
        - cd Codigo/server
      script:
        - npm ci
        - npx eslint . || echo "Configure lint para melhor qualidade de código"

# Notificações
notifications:
  email:
    on_success: change
    on_failure: always

# Branches para executar CI
branches:
  only:
    - main
    - develop
    - /^feature\/.*$/
    - /^hotfix\/.*$/
    - /^release\/.*$/

# Executar apenas em commits e pull requests
if: type IN (push, pull_request)
